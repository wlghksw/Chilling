<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{venue.venueName}} - {{sport.sportName}} 매치 - KDT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .venue-hero {
            height: 300px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .venue-hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .match-info-card {
            border-left: 4px solid #007bff;
        }
        .status-badge {
            font-size: 1rem;
            padding: 0.5rem 1rem;
        }
        .map-container {
            height: 300px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <!-- 구장 이미지 헤더 -->
        <div class="venue-hero" style="background-image: url('{{#venue.venueImage}}{{venue.venueImage}}{{/venue.venueImage}}{{^venue.venueImage}}data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3Crect width='800' height='400' fill='%23f8f9fa'/%3E%3Ctext x='400' y='200' text-anchor='middle' font-size='48' fill='%236c757d'%3E%3Ci class='fas fa-map-marker-alt'%3E%3C/i%3E%3C/text%3E%3C/svg%3E{{/venue.venueImage}}')">
            <div class="venue-hero-overlay">
                <div class="text-center">
                    <h1 class="display-4">{{venue.venueName}}</h1>
                    <p class="lead">{{sport.sportName}} 매치</p>
                    <span class="badge status-badge 
                        {{#status.OPEN}}bg-success{{/status.OPEN}}
                        {{#status.FULL}}bg-warning{{/status.FULL}}
                        {{#status.CANCELLED}}bg-danger{{/status.CANCELLED}}
                        {{#status.COMPLETED}}bg-secondary{{/status.COMPLETED}}">
                        {{#status.OPEN}}모집중{{/status.OPEN}}
                        {{#status.FULL}}마감{{/status.FULL}}
                        {{#status.CANCELLED}}취소{{/status.CANCELLED}}
                        {{#status.COMPLETED}}완료{{/status.COMPLETED}}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row">
            <!-- 매치 정보 -->
            <div class="col-lg-8">
                <div class="card match-info-card mb-4">
                    <div class="card-body">
                        <h3 class="card-title">
                            <i class="fas fa-calendar-alt"></i> 매치 정보
                        </h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-calendar text-primary me-3"></i>
                                    <div>
                                        <small class="text-muted">경기 날짜</small>
                                        <div class="fw-bold">{{matchDate}}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-clock text-primary me-3"></i>
                                    <div>
                                        <small class="text-muted">경기 시간</small>
                                        <div class="fw-bold">{{startTime}} - {{endTime}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-users text-primary me-3"></i>
                                    <div>
                                        <small class="text-muted">참가 인원</small>
                                        <div class="fw-bold">{{currentPlayers}}/{{maxPlayers}}명</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-map-marker-alt text-primary me-3"></i>
                                    <div>
                                        <small class="text-muted">지역</small>
                                        <div class="fw-bold">{{#venue.region}}{{venue.region.regionName}}{{/venue.region}}{{^venue.region}}지역 정보 없음{{/venue.region}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {{#description}}
                        <hr>
                        <div class="mb-3">
                            <small class="text-muted">매치 설명</small>
                            <div class="mt-2">{{description}}</div>
                        </div>
                        {{/description}}
                        

                        
                        <!-- 매치 관리 버튼 (작성자 또는 관리자만 보임) -->
                        {{#isAuthor}}
                        <hr>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">매치 관리</small>
                            </div>
                            <div>
                                <a href="/match/{{matchId}}/edit" class="btn btn-warning btn-sm me-2">
                                    <i class="fas fa-edit"></i> 수정
                                </a>
                                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                    <i class="fas fa-trash"></i> 삭제
                                </button>
                            </div>
                        </div>
                        {{/isAuthor}}
                        
                        {{^isAuthor}}
                        {{#isAdmin}}
                        <hr>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">관리자 매치 관리</small>
                            </div>
                            <div>
                                <a href="/match/{{matchId}}/edit" class="btn btn-warning btn-sm me-2">
                                    <i class="fas fa-edit"></i> 수정
                                </a>
                                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                    <i class="fas fa-trash"></i> 삭제
                                </button>
                            </div>
                        </div>
                        {{/isAdmin}}
                        {{/isAuthor}}
                    </div>
                </div>

                <!-- 구장 정보 -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h4 class="card-title">
                            <i class="fas fa-map-marker-alt"></i> 구장 정보
                        </h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>구장명:</strong> {{venue.venueName}}</p>
                                <p><strong>종목:</strong> {{sport.sportName}}</p>
                                <p><strong>주소:</strong> {{venue.address}}</p>
                            </div>
                            <div class="col-md-6">
                                {{#venue.phone}}
                                <p><strong>연락처:</strong> {{venue.phone}}</p>
                                {{/venue.phone}}
                                {{#venue.description}}
                                <p><strong>설명:</strong> {{venue.description}}</p>
                                {{/venue.description}}
                            </div>
                        </div>
                        
                        <!-- 지도 -->
                        <div class="mt-3">
                            <h6>위치</h6>
                            <div class="map-container d-flex align-items-center justify-content-center">
                                {{#venue.latitude}}
                                {{#venue.longitude}}
                                <div id="map" style="width: 100%; height: 100%; border-radius: 8px;"></div>
                                {{/venue.longitude}}
                                {{/venue.latitude}}
                                {{^venue.latitude}}
                                <div class="text-muted">
                                    <i class="fas fa-map fa-2x mb-2"></i>
                                    <p>지도 정보가 없습니다</p>
                                </div>
                                {{/venue.latitude}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 사이드바 -->
            <div class="col-lg-4">
                <!-- 매치 신청 -->
                <div class="card mb-4">
                    <div class="card-body text-center">
                        {{#status.OPEN}}
                        <h5 class="card-title">매치 신청</h5>
                        <p class="card-text">이 매치에 참여하고 싶으신가요?</p>
                        <a href="/match/{{matchId}}/apply" class="btn btn-success btn-lg w-100">
                            <i class="fas fa-plus"></i> 신청하기
                        </a>
                        {{/status.OPEN}}
                        
                        {{#status.FULL}}
                        <h5 class="card-title text-warning">매치 마감</h5>
                        <p class="card-text">참가 인원이 모두 찼습니다.</p>
                        <button class="btn btn-secondary btn-lg w-100" disabled>마감됨</button>
                        {{/status.FULL}}
                        
                        {{#status.CANCELLED}}
                        <h5 class="card-title text-danger">매치 취소</h5>
                        <p class="card-text">이 매치는 취소되었습니다.</p>
                        <button class="btn btn-danger btn-lg w-100" disabled>취소됨</button>
                        {{/status.CANCELLED}}
                        
                        {{#status.COMPLETED}}
                        <h5 class="card-title text-secondary">매치 완료</h5>
                        <p class="card-text">이 매치는 이미 완료되었습니다.</p>
                        <button class="btn btn-secondary btn-lg w-100" disabled>완료됨</button>
                        {{/status.COMPLETED}}
                    </div>
                </div>

                <!-- 참가자 정보 -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-users"></i> 참가자 ({{currentPlayers}}/{{maxPlayers}})
                        </h5>
                        
                        <div class="progress mb-3">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: {{#currentPlayers}}{{currentPlayers}}{{/currentPlayers}}{{^currentPlayers}}0{{/currentPlayers}}%"
                                 aria-valuenow="{{#currentPlayers}}{{currentPlayers}}{{/currentPlayers}}{{^currentPlayers}}0{{/currentPlayers}}" 
                                 aria-valuemin="0" aria-valuemax="{{maxPlayers}}">
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <small class="text-muted">
                                {{#currentPlayers}}{{currentPlayers}}{{/currentPlayers}}{{^currentPlayers}}0{{/currentPlayers}}명 참가 중
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 공유하기 -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-share-alt"></i> 공유하기
                        </h5>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="shareToKakao()">
                                <i class="fab fa-kickstarter-k"></i> 카카오톡
                            </button>
                            <button class="btn btn-outline-success" onclick="shareToWhatsApp()">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            <button class="btn btn-outline-info" onclick="copyLink()">
                                <i class="fas fa-link"></i> 링크 복사
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 삭제 확인 모달 -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">매치 삭제 확인</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>정말로 이 매치를 삭제하시겠습니까?</p>
                    <p class="text-danger"><strong>이 작업은 되돌릴 수 없습니다.</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <form action="/match/{{matchId}}/delete" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">삭제</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 지도 초기화 (카카오맵 API 사용 예시)
        function initMap() {
            {{#venue.latitude}}
            {{#venue.longitude}}
            if (typeof kakao !== 'undefined' && kakao.maps) {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng({{venue.latitude}}, {{venue.longitude}}),
                    level: 3
                };
                const map = new kakao.maps.Map(container, options);
                
                const marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng({{venue.latitude}}, {{venue.longitude}})
                });
                marker.setMap(map);
            }
            {{/venue.longitude}}
            {{/venue.latitude}}
        }
        
        // 공유 기능
        function shareToKakao() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('{{venue.venueName}} {{sport.sportName}} 매치에 참여해보세요!');
            window.open(`https://story.kakao.com/share?url=${url}&text=${text}`);
        }
        
        function shareToWhatsApp() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('{{venue.venueName}} {{sport.sportName}} 매치에 참여해보세요!');
            window.open(`https://wa.me/?text=${text}%20${url}`);
        }
        
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('링크가 복사되었습니다!');
            });
        }
        

        

        
        // 페이지 로드 시 지도 초기화
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
        });
    </script>
</body>
</html>
